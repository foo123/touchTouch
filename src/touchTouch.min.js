/**
*  touchTouch.js
*  Enhanced Vanilla JavaScript version of https://github.com/tutorialzine/touchTouch Optimized Mobile Gallery by Martin Angelov
*  @VERSION: 1.4.0
*  @license: MIT License
*
*  https://github.com/foo123/touchTouch
*
**/
!function(){"use strict";var x=Math,o=null,t=/(?:-?\d+(?:\.\d+)?)|(?:-?\.\d+)/g,n=/^\s+|\s+$/g,r=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(n,"")};function i(e){return parseFloat(e||0)||0}function E(e){return(String(e).match(t)||[]).map(i)}function D(n,r,o){var i;return function(){var e=this,t=arguments;if(clearTimeout(i),i=setTimeout(function(){i=null,n.apply(e,t)},r),o)return o.apply(e,t)}}function s(){var t=!1,e={};try{Object.defineProperty(e,"passive",{get:function(){return!(t=!0)}}),window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(e){t=!1}return t}function C(e,t,n,r){null==o&&(o=s()),e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,o?r:"object"==typeof r?!!r.capture:!!r)}function N(e,t,n,r){null==o&&(o=s()),e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,o?r:"object"==typeof r?!!r.capture:!!r)}function S(e,t){e.classList?e.classList.add(t):e.className=""===e.className?t:e.className+" "+t}function k(e,t){e.classList?e.classList.remove(t):e.className=r((" "+e.className+" ").replace(" "+t+" "," "))}function L(e){return e.style.setProperty("--touchTouchDisplay",e.style.getPropertyValue("display")),e.style.display="none",e}var b=null,X=null,V=!1,Y=0;function A(e){b&&(27===e.keyCode?O():37===e.keyCode?b.showPrevious():39===e.keyCode&&b.showNext())}function O(){if(!V)return!1;V=!1,b=null,N(window,"keydown",A,{passive:!0,capture:!1}),k(L(X),"visible"),setTimeout(function(){X.textContent=""},0)}function G(e,t){var n,r,o;e&&"img"===(e.tagName||"").toLowerCase()&&(n=e.width,r=e.height,o=t*(window.innerWidth||document.documentElement.clientWidth),(t=t*(window.innerHeight||document.documentElement.clientHeight))<r*o/n?(e.style.height=String(t)+"px",e.style.width="auto"):(e.style.width=String(o)+"px",e.style.height="auto"))}function K(o,e){var f=this;if(!(f instanceof K))return new K(o,e);var v,d,m,i,t,g,y,n,r,s,a,u,w,c,l=0,p=0,h=(c=!!(e=e||{}).auto,p=e.fit,X||((X=document.createElement("div")).id="galleryOverlay","ontouchstart"in window&&S(X,"is-touch-screen"),L(X)),v=document.createElement("div"),d=document.createElement("a"),m=document.createElement("a"),v.id="gallerySlider"+String(++Y),v.style.touchAction="none",S(v,"gallery-slider"),e.slider&&S(v,e.slider),S(d,"prev-arrow"),e.prevArrow&&S(d,e.prevArrow),S(m,"next-arrow"),e.nextArrow&&S(m,e.nextArrow),o=Array.prototype.slice.call(o||[]),i=o.map(function(e,t){var n=document.createElement("div");return S(n,"placeholder"),v.appendChild(n),n}),C(v,"touchstart",t=D(function(e){var i,s,a,u,c,l,t,p,n,h=e.touches&&e.touches.length,r=e.target;"img"===r.tagName.toLowerCase()?h&&2===e.touches.length&&2===e.targetTouches.length||!h&&(e.ctrlKey||e.metaKey)?(w(),i=h?e.touches[0].pageX<=e.touches[1].pageX?[e.touches[0],e.touches[1]]:[e.touches[1],e.touches[0]]:null,s=h?[i[0].pageX,i[0].pageY,i[1].pageX,i[1].pageY]:[e.pageX,e.pageY],a=s,c=E((u=r).style.getPropertyValue("margin-left"))[0]||0,l=E(u.style.getPropertyValue("margin-top"))[0]||0,t=E(u.style.getPropertyValue("transform")),p=t[0]||1,C(v,h?"touchmove":"mousemove",g=function(e){var t,n,r,o;return e.preventDefault&&e.preventDefault(),(!h||2===e.touches.length&&2===e.targetTouches.length)&&(t=h?[i[0].identifier===e.touches[0].identifier?e.touches[0]:i[0].identifier===e.touches[1].identifier?e.touches[1]:null,i[1].identifier===e.touches[0].identifier?e.touches[0]:i[1].identifier===e.touches[1].identifier?e.touches[1]:null]:null,!h||t[0]&&t[1])&&(t=h?[t[0].pageX,t[0].pageY,t[1].pageX,t[1].pageY]:[e.pageX,e.pageY],e=h?(n=c+t[2]-s[2],r=l+t[3]-s[3],o=(t[2]-t[0])/(a[2]-a[0])-1,x.min(x.max(p+.1*o,1),3)):(n=c+t[0]-s[0],r=l+t[1]-s[1],p),s=t,x.abs(e-1)<.01?(l=c=0,p=1,u.style.removeProperty("transform-origin"),u.style.removeProperty("transform"),u.style.removeProperty("margin-left"),u.style.removeProperty("margin-top")):!h||x.abs(o)<.5?(c=n,l=r,u.style.marginLeft=String(c)+"px",u.style.marginTop=String(l)+"px"):(p=e,u.style.transformOrigin="center center",u.style.transform="scale("+p+","+p+")")),!1},{passive:!1,capture:!1}),g.isTouch=h,y=D(w,200),h?(C(v,"touchend",y,{passive:!0,capture:!1}),C(v,"touchcancel",y,{passive:!0,capture:!1})):C(v,"mouseup",y,{passive:!0,capture:!1}),y.isTouch=h):h&&(1!==e.touches.length||1!==e.targetTouches.length)||(w(),n=(h?e.touches[0]:e).pageX,C(v,h?"touchmove":"mousemove",g=function(e){return e.preventDefault&&e.preventDefault(),h&&(1!==e.touches.length||1!==e.targetTouches.length)||(20<(e=(h?e.touches[0]:e).pageX-n)?(w(),f.showPrevious()):e<-20&&(w(),f.showNext())),!1},{passive:!1,capture:!1}),g.isTouch=h,y=D(w,200),h?(C(v,"touchend",y,{passive:!0,capture:!1}),C(v,"touchcancel",y,{passive:!0,capture:!1})):C(v,"mouseup",y,{passive:!0,capture:!1}),y.isTouch=h):d!==r&&m!==r&&(w(),setTimeout(O,100))},60,function(e){return e.preventDefault&&e.preventDefault(),!1}),{passive:!(w=function(){g&&N(v,g.isTouch?"touchmove":"mousemove",g,{passive:!1,capture:!1}),y&&(y.isTouch?(N(v,"touchend",y,{passive:!0,capture:!1}),N(v,"touchcancel",y,{passive:!0,capture:!1})):N(v,"mouseup",y,{passive:!0,capture:!1})),y=g=null}),capture:!1}),C(v,"mousedown",t,{passive:!1,capture:!1}),C(v,"wheel",n=function(e){var t,n;"img"===e.target.tagName.toLowerCase()&&(e.ctrlKey||e.metaKey)&&(e.preventDefault&&e.preventDefault(),n=E((t=e.target).style.getPropertyValue("transform"))[0]||1,n=x.min(x.max(n-.001*e.deltaY,1),3),x.abs(n-1)<.01?(n=1,t.style.removeProperty("transform-origin"),t.style.removeProperty("transform"),t.style.removeProperty("margin")):(t.style.transformOrigin="center center",t.style.transform="scale("+n+","+n+")"))},{passive:!1,capture:!1}),C(d,"click",r=function(e){e.preventDefault&&e.preventDefault(),f.showPrevious()},{passive:!1,capture:!1}),C(m,"click",s=function(e){e.preventDefault&&e.preventDefault(),f.showNext()},{passive:!1,capture:!1}),c||(a=o.map(function(e,t){return C(e,"click",e=function(e){e.preventDefault&&e.preventDefault(),l=t,f.showGallery()},{passive:!1,capture:!1}),e})),f.showGallery=function(){var e;b!==f&&(X.textContent="",X.appendChild(v),X.appendChild(d),X.appendChild(m),h(l),e=f,V||(V=!0,b=e,document.body.appendChild(("none"===(e=X).style.display&&(e.style.display=""!==e.style.getPropertyValue("--touchTouchDisplay")?e.style.getPropertyValue("--touchTouchDisplay"):"block"),e)),C(window,"keydown",A,{passive:!0,capture:!1}),setTimeout(function(){S(X,"visible")},60)),P(l),T(l+1),T(l-1))},function(e){v.style.left=String(100*-e)+"%"}),T=function(e){if(e<0||e>=o.length)return!1;setTimeout(function(){P(e)},1e3)},P=function(e){if(e<0||e>=o.length)return!1;var t,n,r;i[e].children.length||(t=o[e].href,n=function(){p&&(G(this,p),u||C(window,"resize",u=D(function(){i.forEach(function(e){G(e.children[0],p)})},100),{passive:!0,capture:!1})),i[e].textContent="",S(i[e],"loaded"),i[e].appendChild(this)},C(r=document.createElement("img"),"load",function e(){N(r,"load",e),S(r,r.height>r.width?"is-portrait":r.height===r.width?"is-square":"is-landscape"),n.call(r)}),r.src=t)};f.showNext=function(){b===f&&(l+1<o.length?(h(++l),T(l+1)):(S(v,"rightSpring"),setTimeout(function(){k(v,"rightSpring")},500)))},f.showPrevious=function(){b===f&&(0<l?(h(--l),T(l-1)):(S(v,"leftSpring"),setTimeout(function(){k(v,"leftSpring")},500)))},f.dispose=function(){v&&(b===f&&O(),u&&N(window,"resize",u,{passive:!0,capture:!1}),w(),N(v,"touchstart",t,{passive:!1,capture:!1}),N(v,"mousedown",t,{passive:!1,capture:!1}),N(v,"wheel",n,{passive:!1,capture:!1}),N(d,"click",r,{passive:!1,capture:!1}),N(m,"click",s,{passive:!1,capture:!1}),c||o.forEach(function(e,t){N(e,"click",a[t],{passive:!1,capture:!1})}),a=s=r=n=y=t=g=u=null,v.textContent="",e=o=i=m=d=v=null,f.showGallery=null,f.showNext=null,f.showPrevious=null)}}K.VERSION="1.4.0",K.prototype={constructor:K,dispose:null,showGallery:null,showNext:null,showPrevious:null},window.touchTouch=K}();